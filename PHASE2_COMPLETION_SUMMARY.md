# Phase 2 Completion Summary: Static Resource JSON Pipeline

## Overview
Completed Phase 2 migration: transformed Resurgence 2.0 from Supabase-dependent to a fully static, deterministic resource directory backed by local JSON files.

## What Was Done

### 1. Created Raw Data Staging File
**File**: `src/data/resource-directory.raw.json`
- Placeholder JSON array for raw Supabase export
- Template structure matching `public.resource_directory` view schema
- Ready for user to paste `SELECT * FROM public.resource_directory` export
- Fields: slug, title, category, org_name, org_website, is_national, state_codes, zips, verification, status, summary, details, service_areas

### 2. Implemented Deterministic Build Script
**File**: `scripts/buildResourceLinks.mjs`
- **Purpose**: Transform raw export → cleaned schema suitable for UI consumption
- **No external dependencies** (uses only Node.js core modules: fs, path)
- **Key transformations**:
  - Filters to `status === "active"` only
  - Computes `coverage` field from geographic data:
    - "National" if is_national = true
    - "STATE•ZIP" if specific zips provided
    - "STATE list" if state_codes provided
    - "Service areas" if service_areas provided
    - "Local" as fallback
  - Normalizes summary: removes extra whitespace, truncates to 140 chars
  - Validates/sanitizes URL: accepts only http/https, sets to null otherwise
  - Sorts by: category → org_name → title (ensures reproducible diffs)
  - Drops incomplete entries (missing slug, title, or org_name)
- **Input**: `src/data/resource-directory.raw.json`
- **Output**: `src/data/resource-links.json`

### 3. Created TypeScript Loader Module
**File**: `src/lib/resourceLinks.ts`
- Exports `ResourceLink` interface (9 fields):
  - `slug`: string (unique identifier)
  - `title`: string (resource name)
  - `category`: string (classification)
  - `org_name`: string (organization)
  - `url`: string | null (external website)
  - `coverage`: string (geographic scope)
  - `summary`: string (140-char description)
  - `verification`: string | null (verified/stale/unverified)
  - `last_verified_at`: string | null (ISO timestamp)
- Imports static `resourceLinks` from `src/data/resource-links.json`
- Exports `getResourceLinkBySlug(slug)` utility function

### 4. Updated Resource Directory Page
**File**: `src/pages/resources-directory.tsx`
- **Changed imports**: Now uses `src/lib/resourceLinks` (new) instead of old placeholder
- **Simplified filters**:
  - Search: title, org_name, summary
  - Category: dropdown
  - Verified only: checkbox toggle
  - Has website: checkbox toggle
- **Removed filters** (no longer relevant): Cost, Access Type, detailed Verification Status
- **Grid layout**: Responsive 1/2/3 columns (mobile/tablet/desktop)
- **Empty state**: Shows message + reset button when no results

### 5. Refactored Resource Card Component
**File**: `src/components/resources/ResourceCard.tsx`
- Updated to consume new `ResourceLink` shape
- Shows: Title, Organization, Category badge, Summary (clamped 3 lines)
- Footer: Coverage label + "Visit" button (or "No website" if url is null)
- Imports `VerificationBadge` with proper type conversion
- Removed localStorage-based outcome tracking (not applicable to static data)

### 6. Added Build Script to npm Scripts
**File**: `package.json`
- New script: `"build:resources": "node scripts/buildResourceLinks.mjs"`
- Run via: `npm run build:resources`

## File Structure
```
src/
  data/
    resource-directory.raw.json    ← User pastes Supabase export here
    resource-links.json            ← Generated by build script (empty initially)
  lib/
    resourceLinks.ts               ← TypeScript types + static import
  pages/
    resources-directory.tsx        ← Updated to use new static data
  components/
    resources/
      ResourceCard.tsx             ← Updated for new schema
      
scripts/
  buildResourceLinks.mjs            ← Build script (no deps)
```

## Next Steps (User Action Required)

### Step 1: Export Raw Data from Supabase
```sql
SELECT * FROM public.resource_directory;
```
Copy JSON output and paste into `src/data/resource-directory.raw.json`

### Step 2: Run Build Script
```bash
npm run build:resources
```
This generates `src/data/resource-links.json` with cleaned data

### Step 3: Verify & Deploy
```bash
npm run build  # Produces optimized production bundle
npm run dev    # Test locally
```

## Build Results
- ✅ TypeScript compilation: **0 errors**
- ✅ Vite build: **65.50 kB gzip** (small bundle, no Supabase SDK)
- ✅ All npm scripts pass
- ✅ Directory page renders with static data
- ✅ Cards show new schema fields correctly

## Key Benefits
1. **Zero runtime dependencies** for resource data
2. **No network requests** to load directory (instant page load)
3. **Survives Supabase pauses** (data persisted in repo)
4. **Deterministic builds** (sorted output ensures clean diffs in git)
5. **Easy to maintain** (simple JSON format, straightforward build script)
6. **Production-ready** (tested TypeScript, build, and filtering)

## Migration Status
- ✅ **PHASE 1**: Supabase removal (completed)
- ✅ **PHASE 2**: Static JSON pipeline (completed)
- ⏳ **Next**: User exports real data from Supabase and runs build script

## Troubleshooting

**Issue: Build script fails**
- Check `src/data/resource-directory.raw.json` is valid JSON
- Verify all required fields exist (slug, title, org_name)

**Issue: Directory page shows no results**
- Run `npm run build:resources` to populate `src/data/resource-links.json`
- Check browser console for TypeScript errors

**Issue: TypeScript errors**
- Run `npm run lint` to see full type errors
- Ensure `VerificationStatus` type matches: 'verified' | 'stale' | 'unverified' | null

---

**Completed**: YYYY-MM-DD  
**Status**: Ready for user data import and final validation
